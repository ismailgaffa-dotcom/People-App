<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ø·Ù‚Ø³ AI - Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ Ø§Ù„Ù…ÙˆØ­Ø¯</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --tg-bg: #0e1621; --tg-sent: #2b5278; --tg-accent: #64b5f6; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--tg-bg); color: white; height: 100vh; display: flex; flex-direction: column; }
        .header { background: #242f3d; padding: 15px; display: flex; align-items: center; gap: 15px; border-bottom: 2px solid var(--tg-sent); }
        .chat-area { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 12px; background-image: url('https://www.transparenttextures.com/patterns/skulls.png'); }
        .msg { max-width: 85%; padding: 15px; border-radius: 18px; line-height: 1.6; }
        .ai { background: var(--tg-sent); align-self: flex-start; border-bottom-right-radius: 4px; border: 1px solid rgba(255,255,255,0.1); }
        .user { background: #182533; align-self: flex-end; border-bottom-left-radius: 4px; color: #a8b2bd; }
        .report-card { background: rgba(0,0,0,0.4); border-radius: 12px; padding: 15px; margin-top: 10px; border-left: 5px solid var(--tg-accent); }
        .warning-red { color: #ff5252; background: rgba(255,82,82,0.1); padding: 10px; border-radius: 8px; border: 1px solid #ff5252; margin-top: 10px; font-weight: bold; animation: pulse 2s infinite; }
        @keyframes pulse { 0% {opacity: 1;} 50% {opacity: 0.5;} 100% {opacity: 1;} }
        .input-bar { background: #242f3d; padding: 15px; display: flex; gap: 10px; }
        input { flex: 1; background: #17212b; border: 1px solid #2f3b4a; border-radius: 25px; padding: 12px 20px; color: white; outline: none; font-size: 16px; }
        button { background: var(--tg-accent); border: none; color: white; width: 50px; height: 50px; border-radius: 50%; cursor: pointer; }
    </style>
</head>
<body>

<div class="header">
    <div style="width:45px; height:45px; border-radius:50%; background:linear-gradient(45deg, #10a37f, #64b5f6); display:flex; align-items:center; justify-content:center; font-size:22px;">ğŸŒ</div>
    <div>
        <div style="font-weight: bold;">Ø§Ù„Ø·Ù‚Ø³ AI (Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ)</div>
        <div id="liveClock" style="font-size: 12px; color: var(--tg-accent);">Ø¬Ø§Ø±ÙŠ Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ÙˆÙ‚Øª...</div>
    </div>
</div>

<div class="chat-area" id="chat">
    <div class="msg ai">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙˆØ­Ø¯. Ù„Ù‚Ø¯ Ù‚Ù…Øª Ø¨Ø¨Ø±Ù…Ø¬Ø© Ù‡Ø°Ø§ Ø§Ù„Ù€ AI Ù„ÙŠØ¹Ø·ÙŠÙƒ Ù†ØªØ§Ø¦Ø¬ Ø«Ø§Ø¨ØªØ© ÙˆØ§Ø­ØªØ±Ø§ÙÙŠØ© Ù„Ø£ÙŠ Ù…Ø¯ÙŠÙ†Ø© ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù…. <br><b>Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© (Ù…Ø«Ù„Ø§Ù‹: Ø§Ù„Ø¯Ø§Ø± Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡ØŒ Ù„Ù†Ø¯Ù†ØŒ Ø¯Ø¨ÙŠ):</b></div>
</div>

<div class="input-bar">
    <input type="text" id="cityInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø£ÙŠ Ù…Ø¯ÙŠÙ†Ø© ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù…..." onkeypress="if(event.key === 'Enter') processWeather()">
    <button onclick="processWeather()"><i class="fas fa-paper-plane"></i></button>
</div>

<script>
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø§Ø¹Ø© Ø§Ù„Ø­ÙŠØ© ÙÙŠ Ø§Ù„Ù‡ÙŠØ¯Ø±
    function updateClock() {
        const now = new Date();
        document.getElementById('liveClock').innerText = `Ø§Ù„ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø­Ø§Ù„ÙŠ: ${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;
    }
    setInterval(updateClock, 1000);

    async function processWeather() {
        const input = document.getElementById('cityInput');
        const city = input.value.trim();
        if(!city) return;

        addMsg('user', city);
        input.value = '';

        try {
            // Ø¬Ù„Ø¨ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ù…ÙˆØ­Ø¯Ø© (Snap to Center)
            const geoRes = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(city)}&count=1&language=ar`);
            const geoData = await geoRes.json();
            if(!geoData.results) { addMsg('ai', 'âš ï¸ Ù„Ù… Ø£Ø³ØªØ·Ø¹ Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© ÙÙŠ Ø§Ù„Ø®Ø§Ø±Ø·Ø© Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©.'); return; }

            // ØªØ«Ø¨ÙŠØª Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª (ØªÙ‚Ø±ÙŠØ¨ Ù„Ø®Ø§Ù†Ø© ÙˆØ§Ø­Ø¯Ø© Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø«Ø¨Ø§Øª)
            const lat = Math.round(geoData.results[0].latitude * 10) / 10;
            const lon = Math.round(geoData.results[0].longitude * 10) / 10;
            const cityName = geoData.results[0].name;
            const country = geoData.results[0].country;

            const weatherRes = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&hourly=precipitation_probability,surface_pressure&timezone=auto`);
            const wData = await weatherRes.json();

            const temp = wData.current_weather.temperature;
            const wind = wData.current_weather.windspeed;
            const rain = wData.hourly.precipitation_probability[0];
            const pressure = wData.hourly.surface_pressure[0];

            let report = `<b>Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ Ø§Ù„Ù…ÙˆØ­Ø¯ Ù„Ù€ ${cityName} (${country}):</b><br>`;
            report += `<div class="report-card">`;
            report += `ğŸŒ¡ï¸ Ø§Ù„Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ­Ø¯Ø©: ${temp}Â°C<br>`;
            report += `ğŸ’¨ Ø³Ø±Ø¹Ø© Ø§Ù„Ø±ÙŠØ§Ø­: ${wind} ÙƒÙ…/Ø³<br>`;
            report += `â˜” Ø§Ø­ØªÙ…Ø§Ù„ Ø§Ù„Ø£Ù…Ø·Ø§Ø±: ${rain}%<br>`;
            report += `â²ï¸ Ø§Ù„Ø¶ØºØ· Ø§Ù„Ø¬ÙˆÙŠ: ${pressure} hPa`;
            report += `</div>`;

            // ØªØ­Ù„ÙŠÙ„ "Ù†Ø§Ø¶ÙŠ" Ù„Ù„Ù…Ø®Ø§Ø·Ø±
            if(rain > 75 && pressure < 1000) {
                report += `<div class="warning-red">ğŸš¨ Ø¥Ù†Ø°Ø§Ø± Ø£Ø­Ù…Ø±: Ø§Ø­ØªÙ…Ø§Ù„ÙŠØ© ÙÙŠØ¶Ø§Ù†Ø§Øª Ø¹Ø§Ù„ÙŠØ© Ù†ØªÙŠØ¬Ø© Ø§Ù†Ø®ÙØ§Ø¶ Ø§Ù„Ø¶ØºØ· Ø§Ù„Ø¬ÙˆÙŠ!</div>`;
            } else if(wind > 50) {
                report += `<div class="warning-red">ğŸŒªï¸ ØªØ­Ø°ÙŠØ±: Ø±ÙŠØ§Ø­ Ù‚ÙˆÙŠØ© Ù‚Ø¯ ØªØ¤Ø«Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø±ÙƒØ©!</div>`;
            } else {
                report += `<p style="color:#81c784; margin-top:10px;">âœ… Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù‚Ø³ Ù…Ø³ØªÙ‚Ø±Ø© ÙˆØ¢Ù…Ù†Ø© ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª.</p>`;
            }

            addMsg('ai', report);
        } catch(e) { addMsg('ai', 'âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.'); }
    }

    function addMsg(type, text) {
        const chat = document.getElementById('chat');
        const div = document.createElement('div');
        div.className = `msg ${type}`;
        div.innerHTML = text;
        chat.appendChild(div);
        chat.scrollTop = chat.scrollHeight;
    }
</script>
</body>
</html>

